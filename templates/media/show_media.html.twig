{% if app.request.attributes.get('_route') is same as('media::edit') %}
    {{ form_start(form) }}
{% endif %}

<div class="top row">
    <div class="left_side side">

        {% if media is defined %}

        <div class="media_miniature_container media_{{media.orientation | lower }} " data-customer="{{ app.session.get('current_customer').name| lower }}" data-miniature_medium_exist="{{ (miniature_medium_exist is same as(true)) ? "true" : "false" }}"
        data-media_id="{{ media.id }}" data-media_type="{{ media.mediaType }}" data-file_type="{{ fileType }}" data-miniature_low_exist="{{ (miniature_low_exist is same as(true)) ? "true" : "false" }}" >

        {% else %}
        <div class="media_miniature_container" >
        {% endif %}

            <div class="media_container_{{ (fileType is defined and fileType is same as('image')) ? 'img' : 'video' }}">

                {% if media is defined %}

                    {% if miniature_medium_exist is defined and miniature_medium_exist is same as(false) %}

                        <img class="media_miniature miniature_{{ fileType }}" src="/build/images/no-available-image.png" alt="/build/images/no-available-image.png">

                    {% else %}

                             <div class="media_container_arrows">
                                <i class="fas fa-expand-arrows-alt show_expanded_miniature"></i>
                             </div>

                        {% if fileType is same as('image') %}

                              <img class="media_miniature miniature_image" src="/miniatures/{{ app.session.get('current_customer').name| lower }}/image/{{ media.mediaType }}/medium/{{ media.id }}.png"
                              alt="/miniatures/{{ app.session.get('current_customer').name | lower }}/image/{{ media.mediaType }}/medium/{{ media.id }}.png">

                        {% else %}

                                <video class="media_miniature miniature_video">
                                    <source src="/miniatures/{{ app.session.get('current_customer').name| lower }}/video/{{ media.mediaType }}/medium/{{ media.id }}.mp4" type="{{ media.mimeType }}">
                                </video>

                        {% endif %}

                    {% endif %}

                {% endif %}

            </div>
        </div>

    </div>

    <div class="right_side side">

        <div class="media_validity_container">
            <div class="container_header">

                <div class="container_header_child">
                    <div class="icon_container {% if media is defined and ( media.diffusionEnd | date('d-m-Y') | get_date_diff_from_now < 0 or media.diffusionEnd | date('d-m-Y') | get_date_diff_from_now <= 14) %}alert_date{% endif %}">
                        <i class="far fa-clock"></i>
                    </div>

                    <span class="title title--header">Date de validité</span>
                </div>

            </div>

            <div class="container_body date_edit {{ (app.request.attributes.get('_route') is same as('media::edit')) ? 'edit' : '' }}">
                {% if app.request.attributes.get('_route') is same as('media::edit') %}
                    <div class="media_diff_start_container container_body_child">
                        <div class="label_container">
                            {{ form_label(form.diffusionStart) }}
                        </div>

                        <div class="input_container">
                            {{ form_widget(form.diffusionStart) }}
                        </div>
                    </div>

                    <div class="media_diff_end_container container_body_child">
                        <div class="label_container">
                            {{ form_label(form.diffusionEnd) }}
                        </div>

                        <div class="input_container">
                            {{ form_widget(form.diffusionEnd) }}
                        </div>
                    </div>
                {% else %}
                    <div class="container_body_child">
                        <span class="media_diff_start">{{ (media is defined) ? media.diffusionStart | date('d/m/Y') : '' }}</span> au <span class="media_diff_end">{{ (media is defined) ? media.diffusionEnd | date('d/m/Y') : '' }}</span>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="container media_incrustations_container">

            <div class="container_header">

                <div class="container_header_child">

                    <div class="icon_container">
                        <i class="fas fa-euro-sign"></i>
                    </div>
                    <span class="container_header_title title--header">Incrustations</span>

                </div>

                {% if app.request.attributes.get('_route') is same as('media::edit') %}

                    <div class="container_header_child btn_container">
                        <button type="button" class="btn">
                            {#<i class="fas fa-euro-sign"></i> #}
                            Incruster PRIX
                           </button>
                    </div>

                {% endif %}

            </div>

            <div class="container_body">

                <table class="container_table_media">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Prix</th>
                            <th>Rupture</th>
                            <th>Texte</th>
                        </tr>
                    </thead>
                    <tbody class="media_incrustations_list">
                        {% if media_incrustations is defined %}
                            {% for productName, incrusteTypes in media_incrustations %}
                                <tr>
                                    <td>{{ productName }}</td>
                                    <td>
                                        <input type="checkbox" disabled {{ ('Prix' in incrusteTypes) ? 'checked': '' }}>
                                        <span class="custom_checkbox"></span>
                                    </td>
                                    <td>
                                        <input type="checkbox" disabled {{ ('Rupture' in incrusteTypes) ? 'checked': '' }}>
                                        <span class="custom_checkbox"></span>
                                    </td>
                                    <td>
                                        <input type="checkbox" disabled {{ ('Texte' in incrusteTypes) ? 'checked': '' }}>
                                        <span class="custom_checkbox"></span>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                </table>

            </div>

        </div>
    </div>

</div>

{% if app.request.attributes.get('_route') is same as('media::edit') %}
    <div class="col btn_media_update_image">
        <div class="media_update_btn_container">
            <button type="button" class="btn media_replacement_btn">Mettre à jour le média</button>
        </div>
    </div>
{% endif %}

<div class="row middle">

    <div class="left_side side">

        <div class="container">
            <div class="container_child">
                <span class="container_child_title">Nom du produit :</span>
            </div>
            <div class="container_child media_name_container">
                {% if app.request.attributes.get('_route') is same as('media::edit') %}
                    {{ form_widget(form.name, {'attr': {'class': 'media_name'}}) }}
                {% else %}
                    <p class="media_name"></p>
                {% endif %}
            </div>
        </div>

        <div class="container media_characteristics_container">
            <div class="container_child">
                <span class="container_child_title">Caractéristiques :</span>
            </div>
            <div class="container_child">
                <p class="media_characteristics">
                    {% if app.request.attributes.get('_route') is same as('media::edit') %} {{ media_characteristics | join(', ') }} {% endif %}
                </p>
            </div>
        </div>

        <div class="container associated_data_container">
            <div class="container_child container_child_bloc">
                <span class="container_child_criteres"> Critères</span>
            </div>
            <div class="container_child media_criterions_container">

                {% if app.request.attributes.get('_route') is not same as('media::edit') and mediaCriterions is defined %}

                    {% for criterionName in mediaCriterions %}

                        <span>{{ criterionName }}</span>

                    {% endfor %}

                {% elseif app.request.attributes.get('_route') is same as('media::edit') %}

                    {% set criterionsDisplayed = [] %}

                    {% for product in form.products %}

                        {% set currentProduct = product.vars.data  %}

                        {% for criterion in currentProduct.criterions %}

                            {% if criterion not in criterionsDisplayed %}
                                {% set criterionsDisplayed = criterionsDisplayed | merge([criterion]) %}
                                <span class="{{ (product.vars.checked is same as(false)) ? 'hidden': '' }}" data-product_id="{{ currentProduct.id }}">{{ criterion.name }}</span>
                            {% endif %}

                        {% endfor %}

                    {% endfor %}

                {% endif %}

            </div>
        </div>

        <div class="container associated_data_container">
            <div class="container_child container_child_bloc">
                <p class="container_child_tags btn_tags tag_association_btn" >
                    <span class="mini-cercle"><i class="fas fa-plus"></i></span>TAGS
                </p>
            </div>
            <div class="container_child media_tags_container">

                {% if app.request.attributes.get('_route') is not same as('media::edit') and media is defined %}

                    {% for tag in media.tags %}

                        <p class="tag container-tags" data-tag_id="{{ tag.id }}">
                            <span class="mini-cercle" style="background: {{tag.color}};"></span>
                            <span class="current-tags-name">{{ tag.name }}</span>
                        </p>

                    {% endfor %}

                {% elseif app.request.attributes.get('_route') is same as('media::edit') %}

                    {% for tag in form.tags %}

                        {% set currentTag = tag.vars.data  %}

                        <p class="tag container-tags {{ (tag.vars.checked is same as(false)) ? 'hidden': '' }}" data-tag_id="{{ currentTag.id }}">
                            <span class="hidden">{{ form_widget(tag, { 'attr': { 'class': 'tag_checkbox' } }) }}</span>
                            <span class="mini-cercle" style="background: {{currentTag.color}};"></span>
                            <span class="current-tags-name">{{ form_label(tag) }}</span>
                        </p>

                    {% endfor %}

                {% endif %}

            </div>
        </div>

        <div class="container associated_data_container">
            <div class="container_child container_child_bloc">
                <span class="container_child_allergenes">Allergènes</span>
            </div>
            <div class="container_child media_allergens_container">


                {% if app.request.attributes.get('_route') is not same as('media::edit') and mediaAllergens is defined %}

                    {% for allergenName in mediaAllergens %}

                        <span>{{ allergenName }}</span>

                    {% endfor %}

                {% elseif app.request.attributes.get('_route') is same as('media::edit') %}

                    {#{% set allergensDisplayed = [] %}

                    {% for product in form.products %}

                        {% set currentProduct = product.vars.data  %}

                        {% for criterion in currentProduct.criterions %}

                            {% if criterion not in criterionsDisplayed %}
                                {% set criterionsDisplayed = criterionsDisplayed | merge([criterion]) %}
                                <span class="{{ (product.vars.checked is same as(false)) ? 'hidden': '' }}" data-product_id="{{ currentProduct.id }}">{{ criterion.name }}</span>
                            {% endif %}

                        {% endfor %}

                    {% endfor %}#}

                {% endif %}

            </div>
        </div>

    </div>

    <div class="right_side side">

        <div class="media_products_associated_container">
            <div class="container_header">

                <div class="container_header_child">
                    <div class="icon_container">
                        <i class="icon fas fa-link"></i>
                    </div>

                    <span class="container_header_title title--header">Produits associés</span>
                </div>

                {% if app.request.attributes.get('_route') is same as('media::edit') %}
                    <div class="container_header_child btn_container">
                        <button type="button" class="btn product_association_btn">
                            {#<i class="fas fa-link"></i> #}
                            Produits associés
                        </button>
                    </div>
                {% endif %}

            </div>
            <div class="container_body table">
                <table class="table-custome">
                    <tbody class="media_products_list tbody tbody-content scrollbar-table">
                        {% if media is defined and app.request.attributes.get('_route') is not same as('media::edit') and media is defined %}

                            {% for product in media.products %}

                                <tr data-product_id="{{ product.id }}">
                                    <td>{{ product.name }}</td>
                                </tr>

                            {% endfor %}

                        {% elseif app.request.attributes.get('_route') is same as('media::edit') %}

                            {% for product in form.products %}

                                {% set currentProduct = product.vars.data  %}

                                <tr data-product_id="{{ product.vars.name }}" class="{{ (product.vars.checked is same as(false)) ? 'hidden': '' }}">
                                    <td class="hidden">{{ form_widget(product, { 'attr': { 'class': 'product_checkbox' } }) }}</td>
                                    <td class="product_name">{{ form_label(product) }}</td>
                                </tr>

                            {% endfor %}

                        {% endif %}

                    </tbody>

                </table>

            </div>
        </div>

    </div>

</div>

<div class="col bottom">

    <div class="left_side side diffusion_zone_container">

    </div>

    <div class="right_side side sites_container">

    </div>

</div>

{% if app.request.attributes.get('_route') is same as('media::edit') %}

    <div class="save_media_edit_btn_container">
        <button type="button" class="btn btn_back">Annuler</button>
        <button type="submit" class="btn save_media_edit_btn">Modifier</button>
    </div>

    {{ form_end(form) }}

{% endif %}